---
layout : post
title : "Pandas - 날짜 데이터 가공"

categories:
  - Blog
tags:
  - [AI, Machine_Learning, Pandas, Python]

toc: true
toc_sticky: true
 
date: 2025-01-23:52:00 +0900
---
temperatures.csv 파일 사용

#### 사전 준비
```python
import pandas as pd

df = pd.read_csv("./data/temperatures.csv")
df.head()
```
### 가공할 날짜 정보가 어떤 형식인지 확인
- 날짜 데이터는 `날짜형`으로 변경해야 여러가지 날짜 계산을 할 수 있다.
  
```python
df.info() # 잘 불러왔나 확인 했으면 정보 확인
```
### 문자형을 날짜형으로 변경
- `pd.to_datetime(컬럼, format = '날짜형식')`
 
|형식|설명|
|---|---|
|%Y|0을 채운 4자리 연도|
|%y|0을 채운 2자리 연도|
|%m|0을 채운 월|
|%d|0을 채운 일|
|%H|0을 채운 시간|
|%M|0을 채운 분|
|%S|0을 채운 초|

```python
# 날짜형식으로 다룰 수 있게 변경
df["Date1"] = pd.to_datetime(df["Date"], format = '%Y-%m-%d')
```
## 날짜 데이터를 원하는 형식으로 변경
#### .dt.strftime('원하는형식')

```python
df["Date1"].dt.strftime("%Y-%m") # 숫자-숫자 표시
df["Date1"].dt.strftime("%Y년 %m월") # 숫자년 숫자월 표시
```

```python
df['year'] = df["Date1"].dt.year # 년도
df['month'] = df['Date1'].dt.month # 월
df['day'] = df['Date1'].dt.day # 일

df['daypfweek'] = df['Date1'].dt.dayofweek # 요일(0 ~ 6) , 0이 월요일, 6은 일요일
df['dayname'] = df['Date1'].dt.day_name()
```

## 날짜 연산
 - day 연산 : pd.Timedelta(day = 숫자)
 - month 연산 : DateOffset(months = 숫자)
 - year 연산 : DateOffset(years = 숫자)

#### day 계산
```python
# 하루 뒤 날짜 계산
df['plus_day1'] = df['Date1'] + pd.Timedelta(days=1)
```
```python
# 7일 전 날짜 계산
df['minus day7'] = df['Date1'] + pd.Timedelta(days = -7) 
```
#### months, years 계산
- **from pandas.tseries.offsets import DateOffset** 를 해줘야함.

```python
# 월 변화
df['plus_month1'] = df['Date1'] + DateOffset(months = 1)
df['minus month3'] = df['Date1'] + DateOffset(months = -3)
```
```python
# 년 변화
df['plus year1'] = df['Date1'] + DateOffset(years = 1)
df['plus year1'] = df['Date1'] + DateOffset(years = -1)
```
## 날짜 구간 데이터 만들기
`pd.date_range(start = 시작일자, end = 종료일자, periods = 기간수, freq = 주기)`

|형식|설명|
|---|---|
|D|일별|
|W|주별|
|M|월별 말일|
|MS|월별 시작일|
|A|연도별 말일|
|AS|연도별 시작일|

#### 오늘부터 30일 뒤의 날짜
```python
pd.date_range(start="2025-01-14", periods = 30, freq = "D")
```
#### 구간동안의 월 마지막 날 출력
```python
pd.date_range(start="2025-01-01", end="2025-06-30", freq = "M")
```
#### 구간동안의 월 첫 날 출력
```python
pd.date_range(start="2025-01-01", end="2025-06-30", freq = "MS")
```
#### 구간동안의 년 첫 마지막 날 출력
```python
pd.date_range(start = "2025-01-01", end = "2036-12-15", freq = 'A')
```
#### 구간동안의 년 첫 날 출력
```python
pd.date_range(start="2025-01-01", end="2035-12-15", freq='AS')
```
## 기간 이동 계산
`rolling`
- 데이터의 **지정된 크기의 윈도우(슬라이딩 창)**를 이동시키며 계산을 수행.
- 주로 시계열 데이터에서 시간 구간별 통계량을 계산할 때 사용됨.
- 예를 들어, 3일 이동 평균, 30일 이동 합계 등을 구할 때 사용.

```python
# 3일 이동 평균을 구한다고 가정. 
df['rolling_avg'] = df['value'].rolling(window=3).mean()
```

| Index | Date       | Value | Window             | 이동 평균 (`mean`)   |
|-------|------------|-------|--------------------|--------------------|
| 0     | 2023-01-01 | 10    | [10]              | NaN                |
| 1     | 2023-01-02 | 20    | [10, 20]          | NaN                |
| 2     | 2023-01-03 | 30    | [10, 20, 30]      | (10+20+30)/3 = 20.0 |
| 3     | 2023-01-04 | 40    | [20, 30, 40]      | (20+30+40)/3 = 30.0 |
| 4     | 2023-01-05 | 50    | [30, 40, 50]      | (30+40+50)/3 = 40.0 |
| 5     | 2023-01-06 | 60    | [40, 50, 60]      | (40+50+60)/3 = 50.0 |
| 6     | 2023-01-07 | 70    | [50, 60, 70]      | (50+60+70)/3 = 60.0 |

ㄴ